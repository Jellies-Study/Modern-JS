# 14장. 전역변수의 문제점 - 1

> 👩‍ 담당자: 정보연<br/>
> 📝 파트: 변수의 생명주기

![14-1-정보연-칠판사진](../img/14-1-정보연칠판.jpeg)

전역 변수는 무분별한 사용이 위험합니다. 따라서 반드시 사용해야할 이유를 찾기 못했다면 지역 변수를 써야 합니다. 오늘은 전역변수의 `문제점`과 `억제할 수 있는 방법`에 대해 알아보려고 합니다.

---

## 변수의 생명주기
변수는 생성되고 소멸되는 생명주기를 가집니다. 변수의 생명주기는 메모리 공간이 확보된 시점부터 메모리 공간이 해제되어(가비지 콜렉터에 의하여) 가용 메모리 풀에 반환되는 시점까지를 의미합니다.

`전역 변수`는 애플리케이션의 생명 주기와 같고, `지역 변수`는 그 함수(또는 문)의 생명주기와 같습니다.
> 함수의 생명주기와 같은 것인지, 문의 생명주기와 같은 것인지는 **let/const과 var **키워드로 구문 됩니다. 🔎 [자세히 알아보기](https://velog.io/@boyeon_jeong/var%EC%99%80-let%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90%EC%9D%80-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C%EC%9A%94functionblock-scope)

### 1. 전역변수의 생명주기
결국 전역 변수는 애플리케이션의 생명 주기가 같다는 말은, 프로그램을 종료하지 않는 한 영원히 메모리 공간을 점유하게 된다는 말과 같습니다. 따라서 특별한 진입점 없이 코드가 로드되자마자 곧바로 해석되어 실행되고, 더 이상 실행할 문이 없을 때 종료됩니다.

전역 변수의 초기화와 관련된 동작은 브라우저 환경과 Node.js 환경에서 약간 다를 수 있습니다.

1. 브라우저 환경:
   - 브라우저에서는 웹 페이지를 종료할 때 전역 변수가 초기화됩니다.
   - 웹 페이지를 새로고침하거나 닫거나, 다른 페이지로 이동하는 경우에도 전역 변수는 초기화됩니다.
   - 이러한 동작은 브라우저의 새로운 세션 또는 페이지 간의 독립성을 유지하기 위한 목적으로 설계되었습니다.

2. Node.js 환경:
   - Node.js 애플리케이션에서는 전역 변수가 애플리케이션의 종료 시점에 초기화되지 않습니다.
   - Node.js 프로세스는 애플리케이션 실행을 위해 계속 실행되는 동안 전역 변수는 유지됩니다.
   - 전역 변수의 생명주기는 Node.js 프로세스의 생명주기와 일치하므로, 애플리케이션이 종료되거나 Node.js 프로세스가 강제로 종료되면 전역 변수도 초기화됩니다.
   - 종료 이벤트 핸들러를 사용하여 Node.js 애플리케이션이 종료될 때 필요한 정리 작업을 수행할 수 있습니다.

요약하면, 브라우저 환경에서는 웹 페이지의 종료에 따라 전역 변수가 초기화되지만, Node.js 환경에서는 애플리케이션 종료 또는 Node.js 프로세스 종료 시 전역 변수가 초기화됩니다.

또한 전역 변수는(var로 생성한) 전역 객체의 프로퍼티가 되는데, 이 또한 전역 변수의 생명주기가 전역 객체의 생명주기와 일치하다는 것을 의미합니다. 
> **전역 객체란?**
어떤 객체보다 먼저 생성되는 특수한 객체.
브라우저(CS) : window  / node.js(SS) : global 

### 2. 지역변수의 생명주기
- 함수가 호출된 직후에 함수 몸체의 코드가 한줄씩 순차적으로 실행되기 이전에 자바스크립트에 의해 먼저 실행됩니다.(함수 내부에서의 호이스팅)
- 지역 변수는 함수가 생성한 스코프(렉시컬 환경)에 등록됩니다.
- 지역 변수는 스코프가 소멸(메모리 해제)될때까지 유효합니다.

```javascript
var x = 'global';

function foo() {
  	//호이스팅은 스코프 단위로 동작하기 때문에 x는 undefined
	console.log(x);
  	var x = 'local';
}

foo();
console.log(x); //global
```

> 렉시컬 환경은 물리적인 실체가 있다.

---
